# VPN-клиент с поддержкой IPsec и oVPN

> Требует дальнейшей интеграции 
с существующим API, однако уже предусмотрены 
как эндпоинты, так и разные методы взаимодействия, 
как например активное подключение к vpn-серверу возможно 
и посредствам реквеста конфига файла с определенного эндпоинта 
api, так и запросом 3 файлов отдельно в формате json или возможно 
любом другом подходящем.

1. Стэк и принцип работы
2. Работа с API, соединения
3. Интерфейс
4. Конфиг

## Быстрый старт

*Готовый билд симулирующий работу клиента находится в папке build корня.*

В случае внесения каких-либо изменений, 
для компиляции и последующего запуска достаточно ввести следующие команды:

```
npm install
npm rebuild
npm start
``` 

Для билда в .exe можно использовать electron-packager и команду следующего вида:

```
electron-packager <папка с сорскодом> <vpncli> --platform=win32 --arch=x64
``` 

Аргументы взяты под windowsx64, для других платформ потребуются индивидуальные, подробнее [здесь](https://github.com/electron-userland/electron-packager).
Все зависимости конечно уже прописаны в package.json 
и их локнутые версии в package-lock.json

## Стэк и принцип работы

- nodejs *хэд приложения с которого вызываются все составные его части*
- electron *для рендера и работы с интерфейсом*
- node-gyp/node-api *как слой между cpp и js*
- lottie *используется для векторных анимаций*

Все библиотеки, в том числе как shared так и статичные подобраны 
чтобы всегда была вохможность компиляции под win, linux и macos. 
*Приложение кроссплатформенное изначально.*

Для работы с ovpn используется node-api как абстракционный слой между ovpn и node, все методы вызываются 
напрямую посредствам прилинкованной библиотеки и не используя сетевых протоколов 
+ позволяет свободно обновлять node и его модули. Для работы с ipsec (включающий в себя ikev2 как дополнительный метод защиты)
используется нативный vpn-клиент (у каждой os свой соотвественно).

## Работа с API, соединения

VPN-соединения инициируются через конфиги .ovpn и .p12 (опционально). Конфиги получются get-запросом
к одному из указанных в конфигурационном файле приложения эндпоинтов типа '../api/v1/ovpn' и скачивая нужный файл(-ы) 
в выделенную скрытую папку, по умолчанию ожидается, что в запрос к эндпоинту 
вернет файл vpn конфига сразу в нужном формате, однако есть закомментированный 
функционал и для запроса нужных данных отдельно в json, 
не используя для подключений конфиг файлы совсем. 
 
> Любое взаимодействие с vpn-подключениями возможно, если осуществлен вход в валидный аккаунт. Конфиги vpn по умолчанию запрашиваются лишь в случае если директория с этими конфигами (отдельно под каждый протокол) пуста и пользователь выполнил вход в аккаунт.
Также прописана проверка на условный подключенный тариф аккаунта (по умолчанию закомментировано, но давать привилегию в соотвествии с подключенным тарифом пользователю возможность есть).

Вход в аккаунт осуществляется через отдельный эндпоинт api вроде '../api/v1/signin'. Вход в аккаунт может осуществляться двумя способами:
 
1. запрос на эндпоинт входа пары логин + пароль в json формате (предпочтительно работать только в json), в ответ ожидается либо true либо false
2. через открывающуюся отдельно веб-страницу входа
 
Второй вариант может быть более удачным по части безопасности, 
но фунцкионально внедрить можно оба и база есть под каждый из вариантов.
 
Сами же vpn подключения осуществляются посредствам библиотек ipsec и ovpn3, 
оба взятые из открытых сорскод источников с соотвествующей лицензией, 
разрещающей их использование и модификацию, в том числе и в коммерческих целях.
 
## Интерфейс
  
Приложение работает через системный трэй, в интерфейсе придусмотрены:
  
- иконка в трее, основной элемент
- контекстное меню, вызываемое по правому клику (функционально), со следующими пунктами:
  - текущее состояние (подключено/не подключено)
  - активность в завимости от текущего состония (подключиться, отключиться),в случае если пользователь не выполнил вход в аккаунт, пункт будет disabled
  - вход в аккаунт (либо редирект на веб-страницу логина, либо вызов модального окна со входом, либо гибрид последних двух)
  - выход из приложения (app.exit(0))
    
- графический интерфейс (без системных рамок окон), вызываемый по левому клику, включает в себя 
  - индикацию состояния, их существует два (либо подключено либо нет)
  - адрес и порт подключенного соединения (при рестарте обновляется каждый раз)
  - страну подключения (детектится по ip-адресу)
  - стрелку для закрытия (сокрытия) активного окна
    
- модальное окно для входа в аккаунт (опционально)
  
В графической части ui предусмотрены некоторые сложные анимации, они полностью векторные и работает на lottie 
(не требуют активного подключения к сети, все файлы хостятся локально).
  
## Конфиг
   
Конфиг существует для упрощения работы, по умолчанию скрыт для обычного пользователя. Файл имеет следующую структуру json:
   
 ```
{
  "allowConfigEdit": true,
  "oVPNConfDir": "ovpn/",
  "ikev2ConfDir": "p12/",
  "hideConfigDirs": true,
  "allowDebug": false,
  "OVPNConfEndpoint": "localhost/api/v1/config/ovpn",
  "Ikev2ConfEndpoint": "localhost/api/v1/config/ikev2",
  "signinEndpoint": "localhost/api/v1/signin",
  "accountInfoEndpoint": "localhost/api/v1/account",
  "updatesEndpoint": "localhost/api/v1/updates"
  ...
}
```

В нем прописаны как чисто утилитарные параметры, так например и эндпоинты api, 
к которым клиент будет обращаться во время непосредственной работы. В случае, если эндпоинты не указаны, либо им требуется обновление, то клиент обновит конфиг-файл из соответсвующего репозитория (или любого uri).

У приложения предусмотрен мини-менеджер обновлений - проверяет наличие обновлений, обращаясь к соответсвующему эндпоинту, который должен вернуть либо true, либо false. В случае получения ответа true, менеджер
автоматически обновит файлы из указанного репозитория приложения, вне зависимости от того, будут ли изменения на самом деле или нет.